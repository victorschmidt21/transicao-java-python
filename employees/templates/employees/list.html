{% extends 'base.html' %}
{% load static %}

{% block title %}Funcionários{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'employees/style/employee_list.css' %}?v=2">
<link rel="stylesheet" href="{% static 'employees/style/responsive.css' %}?v=2">
{% endblock %}

{% block content %}
<!-- Token CSRF para JavaScript -->
{% csrf_token %}

<header>
  <h1>Funcionários</h1>
</header>

<section class="content">
  <div class="actions">
    <a href="{% url 'employees:employee_create' %}">+ Adicionar Funcionário</a>

    <form method="GET" class="searcher">
      <input type="text" name="search" id="searchInput" value="{{ search }}" placeholder="Pesquisar"
        aria-label="Pesquisar funcionários" />
      <button type="submit" aria-label="Pesquisar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
          <circle cx="11" cy="11" r="6"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
    </form>
  </div>

  <div class="wrapper-table">
    <table class="data-table" role="table" aria-label="Tabela de funcionários">
      <thead>
        <tr>
          <th>Código</th>
          <th>Nome</th>
          <th>E-mail</th>
          <th>Cargo</th>
          <th>Nível de Acesso</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for employee in employees %}
        <tr>
          <td>{{ employee.id }}</td>
          <td>{{ employee.username }}</td>
          <td>{{ employee.email|default:"-" }}</td>
          <td>{{ employee.cargo|default:"-" }}</td>
          <td>{{ employee.access_level }}</td>
          <td>
            <div class="action">
              <a href="{% url 'employees:employee_edit' employee.pk %}" class="edit"
                aria-label="Editar funcionário {{ employee.id }}">Editar</a>
              <button class="delete delete-btn" data-employee-id="{{ employee.pk }}"
                data-employee-name="{{ employee.username }}"
                aria-label="Excluir funcionário {{ employee.id }}">Excluir</button>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="empty-state">
            Nenhum funcionário cadastrado.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<!-- Modal de confirmação de exclusão -->
<div id="deleteModal" class="modal-overlay" style="display: none;">
  <div class="modal-container">
    <div class="modal-content">
      <div class="modal-icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M24 8C15.16 8 8 15.16 8 24C8 32.84 15.16 40 24 40C32.84 40 40 32.84 40 24C40 15.16 32.84 8 24 8ZM24 36C17.38 36 12 30.62 12 24C12 17.38 17.38 12 24 12C30.62 12 36 17.38 36 24C36 30.62 30.62 36 24 36ZM26 28H22V32H26V28ZM26 16H22V24H26V16Z"
            fill="#ef4444" />
        </svg>
      </div>

      <h2 class="modal-title">Tem certeza que deseja excluir?</h2>

      <div class="modal-message">
        <p>Ao excluir não será possível recuperar!</p>
        <p class="employee-name"></p>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" id="cancelDelete">Cancelar</button>
        <button type="button" class="btn btn-confirm" id="confirmDelete">Confirmar</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'employees/script/employee_list.js' %}?v=2"></script>
{% endblock %}