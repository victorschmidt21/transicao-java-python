{% extends 'base.html' %}

{% block title %}Funcionários{% endblock %}

{% block content %}
<div class="content">
  <header>
    <h1>Funcionários</h1>
  </header>

  <div class="actions">
    <a href="#" class="btn-add" id="btnAbrirModal">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
      </svg>
      Adicionar Funcionário
    </a>

    <div class="searcher">
      <input type="text" name="search" id="searchInput" placeholder="Pesquisar" />
      <button type="button" aria-label="Pesquisar" onclick="filtrarTabela()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="wrapper-table">
    <table class="data-table">
      <thead>
        <tr>
          <th>Código</th>
          <th>Nome</th>
          <th class="action">Ações</th>
        </tr>
      </thead>
      <tbody id="tabelaFuncionarios">
        {% for employee in employees %}
        <tr>
          <td>{{ employee.id }}</td>
          <td>{{ employee.username }}</td>
          <td class="action">
            <button class="edit" onclick="editarFuncionario({{ employee.id }})">Editar</button>
            <button class="delete" onclick="excluirFuncionario({{ employee.id }})">Excluir</button>
          </td>
        </tr>
        {% empty %}
        <tr id="emptyRow">
          <td colspan="3" style="text-align: center; color: #9ba2af;">Nenhum funcionário cadastrado</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Modal de Cadastro -->
<div id="modalCadastro" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Cadastro de funcionário</h2>
    </div>
    
    <form id="formCadastro" class="modal-form">
      {% csrf_token %}
      <div class="form-row">
        <div class="form-group">
          <input type="text" id="nome" name="username" placeholder="Nome" required>
        </div>
        <div class="form-group">
          <input type="email" id="email" name="email" placeholder="E-mail" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="celular" name="mobile" placeholder="Celular">
        </div>
        <div class="form-group">
          <input type="text" id="telefone" name="phone" placeholder="Telefone">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="cep" name="cep" placeholder="CEP">
        </div>
        <div class="form-group">
          <input type="text" id="endereco" name="endereco" placeholder="Endereço">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="bairro" name="bairro" placeholder="Bairro">
        </div>
        <div class="form-group">
          <input type="text" id="cidade" name="cidade" placeholder="Cidade">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="complemento" name="complemento" placeholder="Complemento">
        </div>
        <div class="form-group">
          <select id="estado" name="estado">
            <option value="">Estado</option>
            <option value="AC">AC</option>
            <option value="AL">AL</option>
            <option value="AP">AP</option>
            <option value="AM">AM</option>
            <option value="BA">BA</option>
            <option value="CE">CE</option>
            <option value="DF">DF</option>
            <option value="ES">ES</option>
            <option value="GO">GO</option>
            <option value="MA">MA</option>
            <option value="MT">MT</option>
            <option value="MS">MS</option>
            <option value="MG">MG</option>
            <option value="PA">PA</option>
            <option value="PB">PB</option>
            <option value="PR">PR</option>
            <option value="PE">PE</option>
            <option value="PI">PI</option>
            <option value="RJ">RJ</option>
            <option value="RN">RN</option>
            <option value="RS">RS</option>
            <option value="RO">RO</option>
            <option value="RR">RR</option>
            <option value="SC">SC</option>
            <option value="SP">SP</option>
            <option value="SE">SE</option>
            <option value="TO">TO</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="cpf" name="cpf" placeholder="CPF">
        </div>
        <div class="form-group">
          <input type="text" id="rg" name="rg" placeholder="RG">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <select id="nivel_acesso" name="access_level">
            <option value="">Nível de acesso</option>
            <option value="Administrador">Administrador</option>
            <option value="Usuário">Usuário</option>
          </select>
        </div>
        <div class="form-group">
          <input type="password" id="senha" name="password" placeholder="Senha" required>
        </div>
      </div>

      <div class="modal-actions">
        <button type="submit" class="btn-primary" id="btnCadastrar">
          <span class="btn-text">Cadastrar</span>
          <span class="btn-loading" style="display: none;">
            <svg class="spinner" viewBox="0 0 50 50">
              <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
            Cadastrando...
          </span>
        </button>
        <button type="button" class="btn-secondary" id="btnCancelar">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Edição -->
<div id="modalEdicao" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Editar funcionário</h2>
    </div>
    
    <form id="formEdicao" class="modal-form">
      {% csrf_token %}
      <input type="hidden" id="edit_id" name="id">
      
      <div class="form-row">
        <div class="form-group">
          <input type="text" id="edit_nome" name="username" placeholder="Nome" required>
        </div>
        <div class="form-group">
          <input type="email" id="edit_email" name="email" placeholder="E-mail" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="edit_celular" name="mobile" placeholder="Celular">
        </div>
        <div class="form-group">
          <input type="text" id="edit_telefone" name="phone" placeholder="Telefone">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="edit_cep" name="cep" placeholder="CEP">
        </div>
        <div class="form-group">
          <input type="text" id="edit_endereco" name="endereco" placeholder="Endereço">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="edit_bairro" name="bairro" placeholder="Bairro">
        </div>
        <div class="form-group">
          <input type="text" id="edit_cidade" name="cidade" placeholder="Cidade">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="edit_complemento" name="complemento" placeholder="Complemento">
        </div>
        <div class="form-group">
          <select id="edit_estado" name="estado">
            <option value="">Estado</option>
            <option value="AC">AC</option>
            <option value="AL">AL</option>
            <option value="AP">AP</option>
            <option value="AM">AM</option>
            <option value="BA">BA</option>
            <option value="CE">CE</option>
            <option value="DF">DF</option>
            <option value="ES">ES</option>
            <option value="GO">GO</option>
            <option value="MA">MA</option>
            <option value="MT">MT</option>
            <option value="MS">MS</option>
            <option value="MG">MG</option>
            <option value="PA">PA</option>
            <option value="PB">PB</option>
            <option value="PR">PR</option>
            <option value="PE">PE</option>
            <option value="PI">PI</option>
            <option value="RJ">RJ</option>
            <option value="RN">RN</option>
            <option value="RS">RS</option>
            <option value="RO">RO</option>
            <option value="RR">RR</option>
            <option value="SC">SC</option>
            <option value="SP">SP</option>
            <option value="SE">SE</option>
            <option value="TO">TO</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <input type="text" id="edit_cpf" name="cpf" placeholder="CPF">
        </div>
        <div class="form-group">
          <input type="text" id="edit_rg" name="rg" placeholder="RG">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <select id="edit_nivel_acesso" name="access_level">
            <option value="">Nível de acesso</option>
            <option value="Administrador">Administrador</option>
            <option value="Usuário">Usuário</option>
          </select>
        </div>
        <div class="form-group">
          <input type="password" id="edit_senha" name="password" placeholder="Nova senha (deixe em branco para manter)">
        </div>
      </div>

      <div class="modal-actions">
        <button type="submit" class="btn-primary" id="btnEditar">
          <span class="btn-text">Salvar</span>
          <span class="btn-loading" style="display: none;">
            <svg class="spinner" viewBox="0 0 50 50">
              <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
            Salvando...
          </span>
        </button>
        <button type="button" class="btn-secondary" id="btnCancelarEdicao">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<style>
.btn-add {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-add svg {
  width: 16px;
  height: 16px;
}

/* Modal */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 9999;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.modal-overlay.active {
  display: flex;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-container {
  background-color: #1f2937;
  border-radius: 16px;
  padding: 2.5rem;
  max-width: 900px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
}

/* Scrollbar customizada para o modal */
.modal-container::-webkit-scrollbar {
  width: 8px;
}

.modal-container::-webkit-scrollbar-track {
  background: #374151;
  border-radius: 10px;
}

.modal-container::-webkit-scrollbar-thumb {
  background: #4b5563;
  border-radius: 10px;
}

.modal-container::-webkit-scrollbar-thumb:hover {
  background: #5a6575;
}

@keyframes slideUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modal-header {
  margin-bottom: 2rem;
}

.modal-header h2 {
  color: #fff;
  font-size: 1.75rem;
  font-weight: 700;
}

.modal-form {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.25rem;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group input,
.form-group select {
  padding: 0.9rem 1.2rem;
  background-color: #374151;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  transition: background-color 0.2s ease;
}

.form-group input::placeholder {
  color: #9ba2af;
}

.form-group input:focus,
.form-group select:focus {
  background-color: #414d5f;
}

.form-group select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239ba2af' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  padding-right: 2.5rem;
}

.form-group select option {
  background-color: #374151;
  color: #fff;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.btn-primary,
.btn-secondary {
  padding: 0.85rem 2rem;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.btn-primary {
  background-color: #1d4ed8;
  color: #fff;
  flex: 0 0 auto;
}

.btn-primary:hover:not(:disabled) {
  background-color: #2a5add;
}

.btn-primary:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.btn-secondary {
  background-color: #4b5563;
  color: #fff;
}

.btn-secondary:hover {
  background-color: #5a6575;
}

/* Loading Spinner */
.spinner {
  width: 18px;
  height: 18px;
  animation: rotate 2s linear infinite;
}

.spinner .path {
  stroke: #fff;
  stroke-linecap: round;
  animation: dash 1.5s ease-in-out infinite;
}

@keyframes rotate {
  100% {
    transform: rotate(360deg);
  }
}

@keyframes dash {
  0% {
    stroke-dasharray: 1, 150;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 90, 150;
    stroke-dashoffset: -35;
  }
  100% {
    stroke-dasharray: 90, 150;
    stroke-dashoffset: -124;
  }
}

/* Responsividade do Modal */
@media (max-width: 768px) {
  .modal-container {
    width: 95%;
    padding: 2rem;
  }
  
  .form-row {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .modal-actions {
    flex-direction: column;
  }
  
  .btn-primary,
  .btn-secondary {
    width: 100%;
  }
}

/* Customização do SweetAlert2 */
.swal2-container {
  z-index: 10000 !important;
}

/* Prevenir que o SweetAlert2 adicione padding ao body */
body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) {
  padding-right: 0 !important;
  overflow: hidden !important;
}

body.swal2-height-auto {
  height: 100vh !important;
}

/* Garantir que a barra lateral não seja afetada */
.nav {
  padding-right: 0 !important;
  width: 200px !important;
  min-width: 200px !important;
}

.root {
  overflow: hidden !important;
}

.swal2-popup {
  background-color: #1f2937 !important;
  color: #fff !important;
}

.swal2-title {
  color: #fff !important;
}

.swal2-html-container {
  color: #d9d9d9 !important;
}

.swal2-confirm {
  background-color: #ef4444 !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 0.6rem 1.5rem !important;
  font-weight: 600 !important;
}

.swal2-confirm:hover {
  background-color: #dc2626 !important;
}

.swal2-cancel {
  background-color: #4b5563 !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 0.6rem 1.5rem !important;
  font-weight: 600 !important;
}

.swal2-cancel:hover {
  background-color: #5a6575 !important;
}

.swal2-icon.swal2-warning {
  border-color: #f59e0b !important;
  color: #f59e0b !important;
}
</style>

<!-- SweetAlert2 CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Axios CDN -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
// Configuração global do SweetAlert2 para prevenir padding no body
const swalConfig = {
  heightAuto: false,
  didOpen: () => {
    document.body.style.paddingRight = '0px';
    document.body.style.overflow = 'hidden';
  },
  didClose: () => {
    document.body.style.paddingRight = '0px';
    document.body.style.overflow = '';
  }
};

// Elementos do DOM
const modal = document.getElementById('modalCadastro');
const btnAbrirModal = document.getElementById('btnAbrirModal');
const btnCancelar = document.getElementById('btnCancelar');
const formCadastro = document.getElementById('formCadastro');
const btnCadastrar = document.getElementById('btnCadastrar');
const btnText = btnCadastrar.querySelector('.btn-text');
const btnLoading = btnCadastrar.querySelector('.btn-loading');

// Abrir modal
btnAbrirModal.addEventListener('click', (e) => {
  e.preventDefault();
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
});

// Fechar modal
function fecharModal() {
  modal.classList.remove('active');
  document.body.style.overflow = '';
  formCadastro.reset();
}

btnCancelar.addEventListener('click', fecharModal);

// Fechar modal ao clicar fora
modal.addEventListener('click', (e) => {
  if (e.target === modal) {
    fecharModal();
  }
});

// Fechar modal com ESC
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && modal.classList.contains('active')) {
    fecharModal();
  }
});

// Função para obter o CSRF token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// Submeter formulário
formCadastro.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  // Mostrar loading
  btnText.style.display = 'none';
  btnLoading.style.display = 'inline-flex';
  btnCadastrar.disabled = true;
  
  // Coletar dados do formulário
  const formData = new FormData(formCadastro);
  const data = Object.fromEntries(formData.entries());
  
  try {
    const response = await axios.post('/employee/create/', data, {
      headers: {
        'X-CSRFToken': getCookie('csrftoken'),
        'Content-Type': 'application/json'
      }
    });
    
    if (response.data.success) {
      // Sucesso
      await Swal.fire({
        ...swalConfig,
        title: 'Sucesso!',
        text: 'Funcionário cadastrado com sucesso.',
        icon: 'success',
        confirmButtonText: 'OK',
        timer: 2000
      });
      window.location.reload();
    }
  } catch (error) {
    // Esconder loading
    btnText.style.display = 'inline';
    btnLoading.style.display = 'none';
    btnCadastrar.disabled = false;
    
    // Mostrar erro
    let errorMessage = 'Erro ao cadastrar funcionário. Tente novamente.';
    if (error.response && error.response.data && error.response.data.error) {
      errorMessage = error.response.data.error;
    }
    
    Swal.fire({
      ...swalConfig,
      title: 'Erro!',
      text: errorMessage,
      icon: 'error',
      confirmButtonText: 'OK'
    });
    console.error('Erro:', error);
  }
});

// Função de busca
function filtrarTabela() {
  const input = document.getElementById('searchInput');
  const filter = input.value.toUpperCase();
  const tbody = document.getElementById('tabelaFuncionarios');
  const tr = tbody.getElementsByTagName('tr');
  
  for (let i = 0; i < tr.length; i++) {
    const tdCodigo = tr[i].getElementsByTagName('td')[0];
    const tdNome = tr[i].getElementsByTagName('td')[1];
    
    if (tdCodigo || tdNome) {
      const txtCodigo = tdCodigo ? tdCodigo.textContent || tdCodigo.innerText : '';
      const txtNome = tdNome ? tdNome.textContent || tdNome.innerText : '';
      
      if (txtCodigo.toUpperCase().indexOf(filter) > -1 || txtNome.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = '';
      } else {
        tr[i].style.display = 'none';
      }
    }
  }
}

// Buscar ao digitar
document.getElementById('searchInput').addEventListener('keyup', filtrarTabela);

// Modal de edição
const modalEdicao = document.getElementById('modalEdicao');
const btnCancelarEdicao = document.getElementById('btnCancelarEdicao');
const formEdicao = document.getElementById('formEdicao');
const btnEditar = document.getElementById('btnEditar');

// Fechar modal de edição
function fecharModalEdicao() {
  modalEdicao.classList.remove('active');
  document.body.style.overflow = '';
  formEdicao.reset();
}

btnCancelarEdicao.addEventListener('click', fecharModalEdicao);

modalEdicao.addEventListener('click', (e) => {
  if (e.target === modalEdicao) {
    fecharModalEdicao();
  }
});

// Função para editar funcionário
async function editarFuncionario(id) {
  try {
    // Buscar dados do funcionário
    const response = await axios.get(`/employee/${id}/`);
    const employee = response.data;
    
    // Preencher formulário
    document.getElementById('edit_id').value = employee.id;
    document.getElementById('edit_nome').value = employee.username || '';
    document.getElementById('edit_email').value = employee.email || '';
    document.getElementById('edit_celular').value = employee.mobile || '';
    document.getElementById('edit_telefone').value = employee.phone || '';
    document.getElementById('edit_cep').value = employee.cep || '';
    document.getElementById('edit_endereco').value = employee.endereco || '';
    document.getElementById('edit_bairro').value = employee.bairro || '';
    document.getElementById('edit_cidade').value = employee.cidade || '';
    document.getElementById('edit_complemento').value = employee.complemento || '';
    document.getElementById('edit_estado').value = employee.estado || '';
    document.getElementById('edit_cpf').value = employee.cpf || '';
    document.getElementById('edit_rg').value = employee.rg || '';
    document.getElementById('edit_nivel_acesso').value = employee.access_level || '';
    
    // Abrir modal
    modalEdicao.classList.add('active');
    document.body.style.overflow = 'hidden';
  } catch (error) {
    Swal.fire({
      title: 'Erro!',
      text: 'Erro ao carregar dados do funcionário.',
      icon: 'error',
      confirmButtonText: 'OK'
    });
    console.error('Erro:', error);
  }
}

// Submeter formulário de edição
formEdicao.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const btnText = btnEditar.querySelector('.btn-text');
  const btnLoading = btnEditar.querySelector('.btn-loading');
  
  // Mostrar loading
  btnText.style.display = 'none';
  btnLoading.style.display = 'inline-flex';
  btnEditar.disabled = true;
  
  // Coletar dados
  const formData = new FormData(formEdicao);
  const data = Object.fromEntries(formData.entries());
  const id = data.id;
  delete data.id;
  
  // Remover senha se estiver vazia
  if (!data.password) {
    delete data.password;
  }
  
  try {
    const response = await axios.put(`/employee/${id}/update/`, data, {
      headers: {
        'X-CSRFToken': getCookie('csrftoken'),
        'Content-Type': 'application/json'
      }
    });
    
    if (response.data.success) {
      await Swal.fire({
        ...swalConfig,
        title: 'Sucesso!',
        text: 'Funcionário atualizado com sucesso.',
        icon: 'success',
        confirmButtonText: 'OK',
        timer: 2000
      });
      window.location.reload();
    }
  } catch (error) {
    btnText.style.display = 'inline';
    btnLoading.style.display = 'none';
    btnEditar.disabled = false;
    
    let errorMessage = 'Erro ao atualizar funcionário. Tente novamente.';
    if (error.response && error.response.data && error.response.data.error) {
      errorMessage = error.response.data.error;
    }
    
    Swal.fire({
      ...swalConfig,
      title: 'Erro!',
      text: errorMessage,
      icon: 'error',
      confirmButtonText: 'OK'
    });
    console.error('Erro:', error);
  }
});

// Função para excluir funcionário
async function excluirFuncionario(id) {
  const result = await Swal.fire({
    ...swalConfig,
    title: 'Confirmar exclusão',
    text: 'Deseja realmente excluir este funcionário? Esta ação não pode ser desfeita.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Sim, excluir',
    cancelButtonText: 'Cancelar',
    reverseButtons: true
  });
  
  if (!result.isConfirmed) {
    return;
  }
  
  try {
    const response = await axios.delete(`/employee/${id}/delete/`, {
      headers: {
        'X-CSRFToken': getCookie('csrftoken')
      }
    });
    
    if (response.data.success) {
      await Swal.fire({
        ...swalConfig,
        title: 'Excluído!',
        text: 'Funcionário excluído com sucesso.',
        icon: 'success',
        confirmButtonText: 'OK',
        timer: 2000
      });
      window.location.reload();
    }
  } catch (error) {
    let errorMessage = 'Erro ao excluir funcionário. Tente novamente.';
    if (error.response && error.response.data && error.response.data.error) {
      errorMessage = error.response.data.error;
    }
    
    Swal.fire({
      ...swalConfig,
      title: 'Erro!',
      text: errorMessage,
      icon: 'error',
      confirmButtonText: 'OK'
    });
    console.error('Erro:', error);
  }
}
</script>
{% endblock %}

